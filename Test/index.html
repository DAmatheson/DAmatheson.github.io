<!-- vendor.html
    Purpose: Try jQuery mobile
    
    Revision History:
    Drew Matheson, 2014.4.2: Created
    -->

<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
        <meta name="viewport" content="width=device-width, initialscale=1"/>
        <title>PHP Emporium - Add Vendors</title>
        <meta name="author" content="Drew Matheson" />
        <link rel="shortcut icon" href="favicon.ico" />

        <!--CSS-->
        <link rel="stylesheet" href="jqueryMobileDrew.css"/>
        <link rel="stylesheet" href="jquery.mobile.icons.min.css"/>
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile.structure-1.4.2.min.css" />
        <link rel="stylesheet" href="style.css" />

        <!--JS-->
        <script src="jquery-1.11.0.js"></script>
        <script src="jquery.mobile-1.4.2.js"></script>
        <script src="dmAssign5.js"></script>
        <script type="text/javascript">
            $(document).ready(function ()
            {
                initializeFormEvents();

                /// -- Events --
                // Make the reset button setup the province picker 50ms after click
                $("input[type='reset']").on("click", function()
                {
                    setTimeout(setupProvincePicker, 50);
                });

                $(document).on("pagecontainershow", sizeContentHeightToScreen);
                $(window).on("resize, orientationchange", sizeContentHeightToScreen);

                $("#cboCountry").change(setupProvincePicker); // Setup the change event

                // Add hint text to inputs via jQuery so that those without JS don't have to delete it
                $("#txtName").prop("defaultValue", "Vendor Name");
                $("#txtAddress").prop("defaultValue", "Address");
                $("#txtCity").prop("defaultValue", "City");
                $("#txtPostalCode").prop("defaultValue", "Postal/Zip");
                $("#txtPhone").prop("defaultValue", "Phone Number");
                $("#txtFax").prop("defaultValue", "Fax Number");

                $("label").addClass("ui-hidden-accessible"); // Hide labels but leave them for screenreader

                setupProvincePicker(); // Setup cboProvince in case of page refresh with a country selected
                setupSpacing(); // Setup page to JS layout
                setupFormSize(); // Size form elements to my liking
                sizeContentHeightToScreen(); // Size content to the screen size
                
            });

            function setupSpacing()
            {
                // Setup spacing for JS layout

                $("label").css("margin-left", 0); // Remove margin using for no-JS spacing

                $("#frmVendor br").remove(); // Remove br used for no-JS spacing

                // Replace br spacing with bottom margin
                $("#txtName, #txtPostalCode, #cboProvince, #txtFax").parent().css("margin-bottom", 16);
            }

            function sizeContentHeightToScreen()
            {
                // If the content height is less than the screen size, make it fill the screen

                var screen = window.innerHeight || $(window).height(); // Screen size

                var contentHeight = $(".ui-content").height(); // Content size

                if (contentHeight < screen)
                {
                    var header = $(".ui-header").hasClass("ui-header-fixed") ?
                        $(".ui-header").outerHeight() - 1 :
                        $(".ui-header").outerHeight();

                    var footer = $(".ui-footer").hasClass("ui-footer-fixed") ?
                        $(".ui-footer").outerHeight() - 1 :
                        $(".ui-footer").outerHeight();

                    var contentCurrent = $(".ui-content").outerHeight() - contentHeight;

                    var content = screen - header - footer - contentCurrent;

                    $(".ui-content").height(content);
                }
            }

            function setupFormSize()
            {
                // Size various things to my prefered style

                var largestWidth = 0;

                // Make the jQuery mobile container div's widths match child input element
                $("input").each(function()
                {
                    var $this = $(this);
                    var type = $this.prop("type");

                    // Center buttons
                    if (type == "submit" || type == "reset" || type == "button")
                    {
                        $this.parent().css(
                        {
                            "margin-left": "auto",
                            "margin-right": "auto"
                        });
                    }

                    // Make parent element's max width match child
                    $this.parent().css("maxWidth", $this.css("maxWidth"));

                    $this.addClass("ui-mini");

                    if ($this.width() > largestWidth)
                    {
                        largestWidth = $this.width();
                    }
                });

                // Make parent elements' max width match child select element
                $("select").each(function()
                {
                    var $this = $(this);

                    // 52px seems to be the width of the selection part of the element
                    $this.parent().css("maxWidth", $this.width() - 52);

                    // Select elements are enclosed in two divs so we must updated the second parent also
                    $this.parent().parent().css("maxWidth", $this.width() - 52);

                    $this.addClass("ui-mini");

                    if ($this.width() > largestWidth)
                    {
                        largestWidth = $this.width();
                    }
                });

                // Allow the form to be as wide as the widest element
                $("#frmVendor").css("maxWidth", largestWidth);
            }

            function validateForm(eventArgs, formId)
            {
                eventArgs = eventArgs || window.event; // Cross-browser support for event information

                var errorMessage = ""; // Holds an error message or an empty string if everything is valid

                trimAllFormTextInputs(formId);

                // Validate inputs
                errorMessage += validateName("txtName", "Vendor");
                errorMessage += validateAddress("txtAddress");
                errorMessage += validateCity("txtCity");

                if ($("#cboCountry").val() == "U.S.A")
                {
                    errorMessage += validateZipCode("txtPostalCode");

                    // Change name so the error message from validating cboProvince is accurate
                    $("#cboProvince").prop("name", "State");
                }
                else
                {
                    errorMessage += validatePostalCode("txtPostalCode");
                }

                errorMessage += validateSelect("cboCountry");
                errorMessage += validateSelect("cboProvince");
                errorMessage += validatePhoneNumber("txtPhone", "Phone");
                errorMessage += validatePhoneNumber("txtFax", "Fax");

                // Change name back to Province for dealing with the data in PHP
                $("#cboProvince").prop("name", "Province");

                // If error message isn't empty, prevent submit and alert with compound error message
                if (errorMessage != "")
                {
                    // Cross-browser support for cancelling the submit event
                    // If preventDefault exists use it to cancel submit,
                    // else set returnValue to false to cancel submit
                    eventArgs.preventDefault ? eventArgs.preventDefault() : eventArgs.returnValue = false;

                    if ($(".invalid").length > 0)
                    {
                        $(".invalid").get(0).focus();
                    }

                    alert(errorMessage);
                }
            }

            function setupProvincePicker()
            {
                // Sets up cboProvince with matching options based on cboCountry

                var country = $("#cboCountry").val();
                var cboProvince = $("#cboProvince");
                var postalElement = $("#txtPostalCode");
                var isDefaultPostal = false;
                var previousSelection = cboProvince.val() || "Default";

                if (postalElement.val() == postalElement.prop("defaultValue") ||
                    postalElement.val().trim() == "")
                {
                    isDefaultPostal = true;
                }

                if (country == "U.S.A")
                {
                    $("#cboProvince option, #cboProvince optgroup").remove();

                    cboProvince.selectmenu('enable').append(
                        '<option value="Default" selected="selected">-- State --</option>' +
                        '<option value="IL">Illinois</option>' +
                        '<option value="IN">Indiana</option>' +
                        '<option value="ME">Maine</option>' +
                        '<option value="MA">Massachusetts</option>' +
                        '<option value="MI">Michigan</option>' +
                        '<option value="NH">New Hampshire</option>' +
                        '<option value="NY">New York</option>' +
                        '<option value="OH">Ohio</option>' +
                        '<option value="PA">Pennsylvania</option>' +
                        '<option value="VT">Vermont</option>' +
                        '<option value="WI">Wisconsin</option>');

                    if (isDefaultPostal)
                    {
                        postalElement.val("ZIP Code");
                    }

                    postalElement.prop("defaultValue", "ZIP Code");
                }
                else if (country == "Canada")
                {
                    $("#cboProvince option, #cboProvince optgroup").remove();

                    cboProvince.selectmenu('enable').append(
                        '<option value="Default" selected="selected">-- Province --</option>' +
                        '<option value="BC">British Columbia</option>' +
                        '<option value="AB">Alberta</option>' +
                        '<option value="SK">Saskatchewan</option>' +
                        '<option value="MB">Manitoba</option>' +
                        '<option value="ON">Ontario</option>' +
                        '<option value="QB">Quebec</option>' +
                        '<option value="NL">Newfoundland</option>' +
                        '<option value="NB">New Brunswick</option>' +
                        '<option value="NS">Nova Scotia</option>' +
                        '<option value="PE">Prince Edward Island</option>' +
                        '<option value="YT">Yukon</option>' +
                        '<option value="NT">Northwest Territories</option>' +
                        '<option value="NU">Nunavut</option>');

                    if (isDefaultPostal)
                    {
                        postalElement.val("Post Code");
                    }

                    postalElement.prop("defaultValue", "Post Code");
                }
                else
                {
                    $("#cboProvince option, #cboProvince optgroup").remove();

                    cboProvince.selectmenu('disable').append(
                        '<option value="Default" selected="selected">-- Country First --</option>');

                    if (isDefaultPostal)
                    {
                        postalElement.val("Postal/Zip");
                    }

                    postalElement.prop("defaultValue", "Postal/Zip");
                }

                // Reselect the previous selection if it is in the list
                $("#cboProvince option[value='" + previousSelection + "']").prop("selected", true);
                cboProvince.selectmenu('refresh'); // Refresh the list
                
            }
        </script>
    </head>

    <body>
    <div id="page" data-role="page">
        <div id="header" data-role="header" class="ui-grid-b">
            <div id="headerLogo" class="ui-block-a">
                <a href="index.html">
                    <img id="logo" src="DM_Logo.png" alt="My Logo" height="66" width="80" />
                </a>
            </div>
            
            <div id="headerTitle" class="ui-block-b center">
                <a href="index.html">PHP Emporium</a>
            </div>

            <div id="headerLinks" class="ui-block-c">
                <a href="index.html">Employee Home</a> |
                <a href="part.php">Add Part</a> |
                <a href="vendor.php">Add Vendor</a> |
                <a href="query.php">Find Parts by QoH</a>
            </div>
        </div>

        <div id="wrap" class="ui-content">
            <div id="main">
                <h1>PHP Emporium - Add Vendors</h1>

                <p class="center">Enter the vendor information into the corresponding fields below and hit
                    Add Vendor
                </p>

                <form action="part.php" method="post" id="frmVendor" class="center">
                    <label for="txtName">Vendor </label>
                    <input type="text" id="txtName" name="Name" class="topMargin" maxlength="30" />

                    <br />

                    <label for="txtAddress">Address </label>
                    <input type="text" id="txtAddress" name="Address" maxlength="30" />
                    
                    <br />

                    <label for="txtCity">City </label>
                    <input type="text" id="txtCity" name="City" maxlength="20" />

                    <label for="txtPostalCode">Postal / Zip Code </label>
                    <input type="text" id="txtPostalCode" name="PostalCode" maxlength="10" />
                
                    <br />

                    <label for="cboCountry">Country </label>
                    <select id="cboCountry" name="Country" data-mini="true">
                        <option value="Default" selected="selected">-- Country --</option>
                        <option value="Canada">Canada</option>
                        <option value="U.S.A">United States</option>
                    </select>
                    
                    <label for="cboProvince">Province</label>
                    <select id="cboProvince" name="Province" data-mini="true">
                        <option value="Default" selected="selected">-- Country First --</option>

                        <optgroup label="-- Province --">
                            <option value="BC">British Columbia</option>
                            <option value="AB">Alberta</option>
                            <option value="SK">Saskatchewan</option>
                            <option value="MB">Manitoba</option>
                            <option value="ON">Ontario</option>
                            <option value="QB">Quebec</option>
                            <option value="NL">Newfoundland</option>
                            <option value="NB">New Brunswick</option>
                            <option value="NS">Nova Scotia</option>
                            <option value="PE">Prince Edward Island</option>
                            <option value="YT">Yukon</option>
                            <option value="NT">Northwest Territories</option>
                            <option value="NU">Nunavut</option>
                        </optgroup>

                        <optgroup label="---  State  --- ">
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="ME">Maine</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NY">New York</option>
                            <option value="OH">Ohio</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="VT">Vermont</option>
                            <option value="WI">Wisconsin</option>
                        </optgroup>
                    </select>

                    <br />
                
                    <label for="txtPhone">Phone Number </label>
                    <input type="text" id="txtPhone" name="PhoneNumber" maxlength="15" />

                    <label for="txtFax">Fax Number </label>
                    <input type="text" id="txtFax" name="FaxNumber" maxlength="15" />

                    <br />

                    <input type="submit" id="btnSubmit" value="Add Vendor" class="mcenter" 
                            onclick=" validateForm(event, 'frmVendor'); " />
                    <input type="reset" id="btnReset" value="Reset" class="mcenter" />
                </form>
            </div>
        </div>

        <div id="footer" data-role="footer">
            <div id="footer-center">By Drew Matheson</div>
        </div>
    </div>
    </body>
</html>